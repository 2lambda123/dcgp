
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Learning constants in a symbolic regression task &#8212; dCGP documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Learning constants in a symbolic regression task (PART II)" href="learning_constants2.html" />
    <link rel="prev" title="Search for first integrals of Kepler’s problem" href="../tutorials/cpp_kepler_first_integral.html" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto|Comfortaa|Space+Mono">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          dcgp</a>
        <span class="navbar-text navbar-version pull-left"><b>1.3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../installation.html">Install</a></li>
                <li><a href="../quickstart.html">Quick Start</a></li>
                <li><a href="../docs/index.html">Docs</a></li>
                <li><a href="../tutorials/index.html">Tutorials</a></li>
                <li><a href="../theory.html">Theory</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#c">C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#python">Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick start examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#c">C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#python">Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../docs/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../docs/cpp_docs.html">C++ Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/python_docs.html">Python Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">C++ examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index.html#symbolic-regression">Symbolic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index.html#other-applications">Other Applications</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials/index.html#python-examples">Python examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Learning constants in a symbolic regression task</a></li>
<li class="toctree-l2"><a class="reference internal" href="learning_constants2.html">Learning constants in a symbolic regression task (PART II)</a></li>
<li class="toctree-l2"><a class="reference internal" href="solving_odes.html">Solving differential equations with dCGP</a></li>
<li class="toctree-l2"><a class="reference internal" href="weighted_symbolic_regression.html">Weighted dCGP for a symbolic regression task</a></li>
<li class="toctree-l2"><a class="reference internal" href="finding_prime_integrals.html">Discovery of prime integrals with dCGP</a></li>
<li class="toctree-l2"><a class="reference internal" href="An_intro_to_dCGPANNs.html">Representing an Artificial Neural Network as a Cartesian Genetic Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="dCGPANNs_for_classification.html">Training a FFNN in dCGPANN vs.&nbsp;Keras (classification)</a></li>
<li class="toctree-l2"><a class="reference internal" href="dCGPANNs_for_function_approximation.html">Training a FFNN in dCGPANN vs.&nbsp;Keras (regression)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../theory.html">Cartesian Genetic Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory.html#dcgp">dCGP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../theory.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Learning-constants-in-a-symbolic-regression-task">
<h1>Learning constants in a symbolic regression task<a class="headerlink" href="#Learning-constants-in-a-symbolic-regression-task" title="Permalink to this headline">¶</a></h1>
<p>One of the long standing “skeletons in the closet” of GP techniques is the constant finding problem. It is widely acknowledged that the <strong>ephemeral random constant</strong> approach, de facto the main solution proposed to this problem, is far from being satisfactory.</p>
<p>Using dCGP, we are here able to successfully learn constants as well as expressions during evolution thanks to the hybridization of the evolutionary strategy with a, second order, gradient descent approach that learns the exact value of ephemeral constants, thus avoiding to build such a value by applying kernel functions to the constants.</p>
<p>Lets first import dcgpy and pyaudi and set up things as to compute our CGP using the type “gdual” and thus get for free all derivatives</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dcgpy</span> <span class="kn">import</span> <span class="n">expression_gdual_vdouble</span> <span class="k">as</span> <span class="n">expression</span>
<span class="kn">from</span> <span class="nn">dcgpy</span> <span class="kn">import</span> <span class="n">kernel_set_gdual_vdouble</span> <span class="k">as</span> <span class="n">kernel_set</span>
<span class="kn">from</span> <span class="nn">pyaudi</span> <span class="kn">import</span> <span class="n">gdual_vdouble</span> <span class="k">as</span> <span class="n">gdual</span>
<span class="kn">import</span> <span class="nn">pyaudi</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="section" id="The-kernel-functions">
<h2>The kernel functions<a class="headerlink" href="#The-kernel-functions" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># note he use of the protected division &quot;pdiv&quot; (not necessary here)</span>
<span class="c1"># note the call operator (returns the list of kernels)</span>
<span class="n">kernels</span> <span class="o">=</span> <span class="n">kernel_set</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mul&quot;</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">,</span><span class="s2">&quot;pdiv&quot;</span><span class="p">])()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="The-ES-(1+)-algorithm">
<h2>The ES-(1+<span class="math">\(\lambda\)</span>) algorithm<a class="headerlink" href="#The-ES-(1+)-algorithm" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">offsprings</span><span class="p">,</span> <span class="n">max_gen</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">screen_output</span><span class="p">):</span>
    <span class="c1"># The offsprings chromosome, fitness and constant</span>
    <span class="n">chromosome</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">offsprings</span>
    <span class="n">fitness</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="n">offsprings</span>
    <span class="n">constant</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">offsprings</span>
    <span class="c1"># Init the best as the initial random dCGP</span>
    <span class="n">best_chromosome</span> <span class="o">=</span> <span class="n">dCGP</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">best_constant</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">fit</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">err2</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">best_constant</span><span class="p">)</span>
    <span class="n">best_fitness</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">constant_cf</span><span class="p">)</span>
    <span class="c1"># Main loop over generations</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_gen</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offsprings</span><span class="p">):</span>
            <span class="n">dCGP</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">best_chromosome</span><span class="p">)</span>
            <span class="n">cumsum</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">dCGP</span><span class="o">.</span><span class="n">mutate_active</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fit</span><span class="p">,</span> <span class="n">constant</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">err2</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">best_constant</span><span class="p">)</span>
            <span class="n">fitness</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">constant_cf</span> <span class="p">)</span>
            <span class="n">chromosome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCGP</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offsprings</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fitness</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">best_fitness</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fitness</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">best_fitness</span><span class="p">):</span>
                    <span class="n">best_chromosome</span> <span class="o">=</span> <span class="n">chromosome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">best_fitness</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">best_constant</span> <span class="o">=</span> <span class="n">constant</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">dCGP</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">best_chromosome</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">screen_output</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;New best found: gen: &quot;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="s2">&quot; value: &quot;</span><span class="p">,</span> <span class="n">fitness</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>  <span class="n">dCGP</span><span class="o">.</span><span class="n">simplify</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot;c =&quot;</span><span class="p">,</span> <span class="n">best_constant</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">best_fitness</span> <span class="o">&lt;</span> <span class="mf">1e-14</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">g</span><span class="p">,</span> <span class="n">best_chromosome</span><span class="p">,</span> <span class="n">best_constant</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="The-test-problems">
<h2>The test problems<a class="headerlink" href="#The-test-problems" title="Permalink to this headline">¶</a></h2>
<p>As target functions, we define three different problems of increasing complexity:</p>
<p>P1: <span class="math">\(x^5 - \pi x^3 + x\)</span></p>
<p>P2: <span class="math">\(x^5 - \pi x^3 + \frac{2\pi}x\)</span></p>
<p>P3: <span class="math">\(\frac{e x^5 + x^3}{x + 1}\)</span></p>
<p>P4: <span class="math">\(\sin(\pi x) + \frac 1x\)</span></p>
<p>note how <span class="math">\(\pi\)</span> and <span class="math">\(e\)</span> are present in the expressions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># The following functions create the target values for a gridded input x for different test problems</span>
<span class="k">def</span> <span class="nf">data_P1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">x</span>
<span class="k">def</span> <span class="nf">data_P2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">x</span>
<span class="k">def</span> <span class="nf">data_P3</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">data_P4</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pyaudi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="n">x</span>
<span class="k">def</span> <span class="nf">data_P5</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="The-error-functions">
<h2>The error functions<a class="headerlink" href="#The-error-functions" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># This is the quadratic error of a dCGP expression when the constant value is cin. The error is computed</span>
<span class="c1"># over the input points xin (of type gdual, order 0 as we are not interested in expanding the program w.r.t. these)</span>
<span class="c1"># The target values are contained in yt (of type gdual, order 0 as we are not interested in expanding the program w.r.t. these)</span>
<span class="k">def</span> <span class="nf">err</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">xin</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">cin</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gdual</span><span class="p">([</span><span class="n">cin</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">dCGP</span><span class="p">([</span><span class="n">xin</span><span class="p">,</span><span class="n">c</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># This is the quadratic error of the expression when the constant value is learned using a, one step,</span>
<span class="c1"># second order method.</span>
<span class="k">def</span> <span class="nf">err2</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">xin</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span><span class="n">cin</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gdual</span><span class="p">([</span><span class="n">cin</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">dCGP</span><span class="p">([</span><span class="n">xin</span><span class="p">,</span><span class="n">c</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">err</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span><span class="n">xin</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span><span class="n">cin</span><span class="p">)</span>
    <span class="n">dc</span> <span class="o">=</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">get_derivative</span><span class="p">({</span><span class="s2">&quot;dc&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}))</span>
    <span class="n">dc2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">get_derivative</span><span class="p">({</span><span class="s2">&quot;dc&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}))</span>
    <span class="k">if</span> <span class="n">dc2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">learned_constant</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">dc</span><span class="o">/</span><span class="n">dc2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">dCGP</span><span class="p">([</span><span class="n">xin</span><span class="p">,</span> <span class="n">learned_constant</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">learned_constant</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">learned_constant</span><span class="o">.</span><span class="n">constant_cf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Problem-P1:-">
<h2>Problem P1: <span class="math">\(x^5 - \pi x^3 + x\)</span><a class="headerlink" href="#Problem-P1:-" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">gdual</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">yt</span> <span class="o">=</span> <span class="n">data_P1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># We run nexp experiments and accumulate statistic for the ERT</span>
<span class="n">nexp</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">offsprings</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">max_gen</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kernels</span> <span class="o">=</span> <span class="n">kernel_set</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mul&quot;</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">,</span><span class="s2">&quot;pdiv&quot;</span><span class="p">])()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;restart: </span><span class="se">\t</span><span class="s2"> gen: </span><span class="se">\t</span><span class="s2"> expression:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nexp</span><span class="p">):</span>
    <span class="n">dCGP</span> <span class="o">=</span> <span class="n">expression</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">levels_back</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">arity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernels</span><span class="o">=</span><span class="n">kernels</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1233456</span><span class="p">))</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">best_chromosome</span><span class="p">,</span> <span class="n">best_constant</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">offsprings</span><span class="p">,</span><span class="n">max_gen</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span> <span class="n">screen_output</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">dCGP</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">best_chromosome</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot; a.k.a &quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="o">.</span><span class="n">simplify</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot;c = &quot;</span><span class="p">,</span> <span class="n">best_constant</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
restart:         gen:    expression:
5                163     [&#39;((((x*x)-c)/(x/((x*x)*(x*x))))+x)&#39;]  a.k.a  [-c*x**3 + x**5 + x] c =  3.141592653589793
8                452     [&#39;(x+((((((x/c)*(c*x))-(c+c))*((x/c)*(c*x)))-((x/c)*(c*x)))*x))&#39;]  a.k.a  [-2*c*x**3 + x**5 - x**3 + x] c =  1.0707963267948972
12               309     [&#39;(((x*x)*(((c-(x*x))*(x*x))/(((c-(x*x))*(x*x))*x)))-(((c-(x*x))*(x*x))*x))&#39;]  a.k.a  [-c*x**3 + x**5 + x] c =  3.141592653589793
15               764     [&#39;(((x/c)*c)+((x*(x*x))*((x*x)-c)))&#39;]  a.k.a  [-c*x**3 + x**5 + x] c =  3.1415926535897927
18               193     [&#39;(((x*(x*x))*((x*x)+c))-(c-(c+x)))&#39;]  a.k.a  [c*x**3 + x**5 + x] c =  -3.1415926535897927
36               334     [&#39;(x+((x*x)*(((((x*x)-c)+x)*x)-(x*x))))&#39;]  a.k.a  [-c*x**3 + x**5 + x] c =  3.1415926535897927
54               826     [&#39;((((x*x)*x)*((c+(x*x))+c))+x)&#39;]  a.k.a  [2*c*x**3 + x**5 + x] c =  -1.5707963267948968
57               154     [&#39;(((x+((x*x)+c))-((x*x)+c))+(((x*x)+c)*((x*x)*x)))&#39;]  a.k.a  [c*x**3 + x**5 + x] c =  -3.1415926535897927
58               312     [&#39;((((x*x)+c)*(x*(x*x)))-((x*(x*x))+((x*(x*x))-x)))&#39;]  a.k.a  [c*x**3 + x**5 - 2*x**3 + x] c =  -1.1415926535897931
66               378     [&#39;(((((x*x)-c)*(x*x))*x)+x)&#39;]  a.k.a  [-c*x**3 + x**5 + x] c =  3.1415926535897927
72               68      [&#39;(((c/x)/((c/x)/x))-((((x*c)*x)*x)-((((x*c)*x)*x)/((c/x)/x))))&#39;]  a.k.a  [-c*x**3 + x**5 + x] c =  3.141592653589794
77               67      [&#39;(x+((x*x)*(x*((x*x)+c))))&#39;]  a.k.a  [c*x**3 + x**5 + x] c =  -3.1415926535897927
81               891     [&#39;(((x*(x/(x/x)))+(x*((x*(x/(x/x)))*((x*(x/(x/x)))+(c+(x/x))))))-((x*(x/(x/x)))-x))&#39;]  a.k.a  [c*x**3 + x**5 + x**3 + x] c =  -4.141592653589793
83               815     [&#39;(((x*x)*(((x*x)-c)*x))+((x*c)/c))&#39;]  a.k.a  [-c*x**3 + x**5 + x] c =  3.1415926535897927
97               210     [&#39;((((x*x)/c)+((x*x)*(x*x)))*(x+(c/x)))&#39;]  a.k.a  [c*x**3 + x**5 + x + x**3/c] c =  -2.782160919529689
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">mean_gen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="o">&lt;</span><span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;ERT Expected run time = avg. number of dCGP evaluations needed: &quot;</span><span class="p">,</span> <span class="n">mean_gen</span> <span class="o">*</span> <span class="n">offsprings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ERT Expected run time = avg. number of dCGP evaluations needed:  19902.4444444
</pre></div></div>
</div>
</div>
<div class="section" id="Problem-P2---">
<h2>Problem P2 - <span class="math">\(x^5 - \pi x^3 + \frac{2\pi}x\)</span><a class="headerlink" href="#Problem-P2---" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># we include points close to zero here to favour learning of 1/x</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">gdual</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">yt</span> <span class="o">=</span> <span class="n">data_P2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># We run nexp experiments and accumulate statistic for the ERT</span>
<span class="n">nexp</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">offsprings</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">max_gen</span><span class="o">=</span><span class="mi">5000</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kernels</span> <span class="o">=</span> <span class="n">kernel_set</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mul&quot;</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">,</span><span class="s2">&quot;pdiv&quot;</span><span class="p">])()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;restart: </span><span class="se">\t</span><span class="s2"> gen: </span><span class="se">\t</span><span class="s2"> expression:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nexp</span><span class="p">):</span>
    <span class="n">dCGP</span> <span class="o">=</span> <span class="n">expression</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">levels_back</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">arity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernels</span><span class="o">=</span><span class="n">kernels</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1233456</span><span class="p">))</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">best_chromosome</span><span class="p">,</span> <span class="n">best_constant</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">offsprings</span><span class="p">,</span><span class="n">max_gen</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span> <span class="n">screen_output</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">dCGP</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">best_chromosome</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot; a.k.a &quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="o">.</span><span class="n">simplify</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot;c = &quot;</span><span class="p">,</span> <span class="n">best_constant</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
restart:         gen:    expression:
2                4663    [&#39;(((x-((((x*x)-c)*x)/(x*x)))+((((x*x)-c)*x)*(x*x)))+(x-((((x*x)-c)*x)/(x*x))))&#39;]  a.k.a  [-c*x**3 + 2*c/x + x**5] c =  3.1415926535897913
6                1520    [&#39;((x*((x*x)*((x*x)+c)))+((((x*x)-c)-((x*x)+c))/x))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.1415926535897927
15               2945    [&#39;(((x*((c*x)/c))*((x*(x*((c*x)/c)))+(c*x)))-((c+c)*(c/(c*x))))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.1415926535897927
18               1937    [&#39;((((x*x)*x)*(c+(x*x)))-(((x/(x*x))*c)+((x/(x*x))*c)))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.141592653589793
20               3489    [&#39;(x*((c/(x*x))-(((x*x)*(c-(x*x)))-(c/(x*x)))))&#39;]  a.k.a  [-c*x**3 + 2*c/x + x**5] c =  3.1415926535897905
21               3427    [&#39;((((c+(x*x))*((x*x)*x))+x)-(((c+(x*x))*(x/(x*x)))-(x-((c+(x*x))*(x/(x*x))))))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.1415926535897944
36               1999    [&#39;((((x*x)*(x*c))*((x*x)/c))-(((x*x)*(x*c))-((c+c)/x)))&#39;]  a.k.a  [-c*x**3 + 2*c/x + x**5] c =  3.141592653589792
44               3911    [&#39;((((c+(x*x))*(x*x))-((c/(x*x))+(c/(x*x))))*x)&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.141592653589789
52               4993    [&#39;((((x-x)/(c+c))-((x*(x*x))*(c-(x*x))))+((c+c)/x))&#39;]  a.k.a  [-c*x**3 + 2*c/x + x**5] c =  3.141592653589792
56               3723    [&#39;(((x-((c+(x*x))/x))+(x-((c+(x*x))/x)))+((c+(x*x))*(x*(x*x))))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.1415926535897913
68               3551    [&#39;(((((x*x)-c)-(c+(x*x)))/x)+((c+(x*x))*((x*x)*x)))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.1415926535897936
69               1716    [&#39;(((((x*x)-c)*(x*x))*x)+((c+c)/x))&#39;]  a.k.a  [-c*x**3 + 2*c/x + x**5] c =  3.141592653589794
75               315     [&#39;(((((x*x)*((x*x)+c))/(c/x))*((c/x)*x))-((c/x)+(c/x)))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.1415926535897922
76               3441    [&#39;((((x*x)*((x*x)+c))*x)-((c/x)+(c/x)))&#39;]  a.k.a  [c*x**3 - 2*c/x + x**5] c =  -3.141592653589797
79               1366    [&#39;(((c/x)+(c/x))+((((x*x)-c)*x)/((c/x)/((x*x)*(c/x)))))&#39;]  a.k.a  [-c*x**3 + 2*c/x + x**5] c =  3.1415926535897927
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">mean_gen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="o">&lt;</span><span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;ERT Expected run time = avg. number of dCGP evaluations needed: &quot;</span><span class="p">,</span> <span class="n">mean_gen</span> <span class="o">*</span> <span class="n">offsprings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ERT Expected run time = avg. number of dCGP evaluations needed:  124776.266667
</pre></div></div>
</div>
</div>
<div class="section" id="Problem-P3---">
<h2>Problem P3 - <span class="math">\(\frac{e x^5 + x^3}{x + 1}\)</span><a class="headerlink" href="#Problem-P3---" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">gdual</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">yt</span> <span class="o">=</span> <span class="n">data_P3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># We run nexp experiments and accumulate statistic for the ERT</span>
<span class="n">nexp</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">offsprings</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">max_gen</span><span class="o">=</span><span class="mi">5000</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kernels</span> <span class="o">=</span> <span class="n">kernel_set</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mul&quot;</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">,</span><span class="s2">&quot;pdiv&quot;</span><span class="p">])()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;restart: </span><span class="se">\t</span><span class="s2"> gen: </span><span class="se">\t</span><span class="s2"> expression:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nexp</span><span class="p">):</span>
    <span class="n">dCGP</span> <span class="o">=</span> <span class="n">expression</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">levels_back</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">arity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernels</span><span class="o">=</span><span class="n">kernels</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1233456</span><span class="p">))</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">best_chromosome</span><span class="p">,</span> <span class="n">best_constant</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">offsprings</span><span class="p">,</span><span class="n">max_gen</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span> <span class="n">screen_output</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">dCGP</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">best_chromosome</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot; a.k.a &quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="o">.</span><span class="n">simplify</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot;c = &quot;</span><span class="p">,</span> <span class="n">best_constant</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
restart:         gen:    expression:
1                2610    [&#39;((((x*x)-((x*x)*(c*(x*x))))*(x*x))/(x+(x*x)))&#39;]  a.k.a  [-c*x**6/(x**2 + x) + x**4/(x**2 + x)] c =  -2.7182818284590438
5                3618    [&#39;(((x*(x*(c*x)))*(x/((c*x)+(x*(c*x)))))*(((x-c)/(x-c))+(x*(c*x))))&#39;]  a.k.a  [c**2*x**6/(c*x**2 + c*x) + c*x**4/(c*x**2 + c*x)] c =  2.7182818284590478
10               3956    [&#39;(((x*x)*((x*x)+(((x*x)*c)*(x*x))))/((x*x)+x))&#39;]  a.k.a  [c*x**6/(x**2 + x) + x**4/(x**2 + x)] c =  2.7182818284590455
14               4942    [&#39;((((((c*x)*x)/c)*(((c/c)+((c*x)*x))*((c*x)*x)))*(c/c))/((c*x)+((c*x)*x)))&#39;]  a.k.a  [c**2*x**6/(c*x**2 + c*x) + c*x**4/(c*x**2 + c*x)] c =  2.718281828459043
27               4107    [&#39;((((c*(x*x))*(x*x))+(x*x))*(((c*(x*x))*(x*x))/((x*(c*(x*x)))+((x*(c*(x*x)))*x))))&#39;]  a.k.a  [c**2*x**8/(c*x**4 + c*x**3) + c*x**6/(c*x**4 + c*x**3)] c =  2.7182818284590287
77               1921    [&#39;((x*((x*x)+(x*(((x*x)*c)*x))))/(((x*((x*x)+(x*(((x*x)*c)*x))))/(x*((x*x)+(x*(((x*x)*c)*x)))))+x))&#39;]  a.k.a  [c*x**5/(x + 1) + x**3/(x + 1)] c =  2.7182818284590455
78               3011    [&#39;(((x-((x*(c*x))*x))/((x*(c*x))+((x*(c*x))/x)))*((x*(c*x))*x))&#39;]  a.k.a  [-c**2*x**6/(c*x**2 + c*x) + c*x**4/(c*x**2 + c*x)] c =  -2.7182818284590495
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">mean_gen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="o">&lt;</span><span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;ERT Expected run time = avg. number of dCGP evaluations needed: &quot;</span><span class="p">,</span> <span class="n">mean_gen</span> <span class="o">*</span> <span class="n">offsprings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ERT Expected run time = avg. number of dCGP evaluations needed:  279469.714286
</pre></div></div>
</div>
</div>
<div class="section" id="Problem-P4:-">
<h2>Problem P4: <span class="math">\(\sin(\pi x) + \frac 1x\)</span><a class="headerlink" href="#Problem-P4:-" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">gdual</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">yt</span> <span class="o">=</span> <span class="n">data_P4</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># We run nexp experiments and accumulate statistic for the ERT</span>
<span class="n">nexp</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">offsprings</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">max_gen</span><span class="o">=</span><span class="mi">5000</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kernels</span> <span class="o">=</span> <span class="n">kernel_set</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mul&quot;</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">,</span><span class="s2">&quot;pdiv&quot;</span><span class="p">,</span><span class="s2">&quot;sin&quot;</span><span class="p">])()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;restart: </span><span class="se">\t</span><span class="s2"> gen: </span><span class="se">\t</span><span class="s2"> expression:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nexp</span><span class="p">):</span>
    <span class="n">dCGP</span> <span class="o">=</span> <span class="n">expression</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">levels_back</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">arity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernels</span><span class="o">=</span><span class="n">kernels</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1233456</span><span class="p">))</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">best_chromosome</span><span class="p">,</span> <span class="n">best_constant</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">dCGP</span><span class="p">,</span> <span class="n">offsprings</span><span class="p">,</span><span class="n">max_gen</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span> <span class="n">screen_output</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">dCGP</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">best_chromosome</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot; a.k.a &quot;</span><span class="p">,</span> <span class="n">dCGP</span><span class="o">.</span><span class="n">simplify</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="s2">&quot;c = &quot;</span><span class="p">,</span> <span class="n">best_constant</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
restart:         gen:    expression:
5                2914    [&#39;(sin((x/c))+(((x-(x/c))/((x*(x-(x/c)))/c))/(x/(x/c))))&#39;]  a.k.a  [sin(x/c) + 1/x] c =  0.3183098859546274
12               808     [&#39;((c/((x*c)+((x*c)-(x*c))))+sin((x+((x*c)+((x*c)-(x*c))))))&#39;]  a.k.a  [sin(c*x + x) + 1/x] c =  2.1415926536812546
17               1434    [&#39;(sin(((x*c)+x))+(c/(x*c)))&#39;]  a.k.a  [sin(c*x + x) + 1/x] c =  2.1415926536986984
28               1079    [&#39;((c/(x*c))+sin((x+((x*c)+(x*c)))))&#39;]  a.k.a  [sin(2*c*x + x) + 1/x] c =  1.0707963267948972
29               2113    [&#39;(sin((((x/c)/c)+(x+x)))+((x/x)/x))&#39;]  a.k.a  [sin(2*x + x/c**2) + 1/x] c =  -0.935932260872573
35               3739    [&#39;(((c/c)/x)+sin(((c-(c-x))+((x*(c+(c/c)))+x))))&#39;]  a.k.a  [sin(c*x + 3*x) + 1/x] c =  0.14159265368124904
36               127     [&#39;((c/(x*c))-(sin(((x*c)-c))*((c/(x*c))/(c/(x*c)))))&#39;]  a.k.a  [-sin(c*x - c) + 1/x] c =  3.1415926536189205
39               805     [&#39;(sin(((x*c)+(x*c)))+(c/(x*c)))&#39;]  a.k.a  [sin(2*c*x) + 1/x] c =  1.5707963267952043
46               4412    [&#39;(sin(((x/c)+x))+((sin(((x/c)+x))+x)/((sin(((x/c)+x))+x)*x)))&#39;]  a.k.a  [sin(x + x/c) + 1/x] c =  0.4669422068457747
53               2197    [&#39;((((c/x)*(c/x))*(((c/(c/x))/c)/c))+sin((((c/(c/x))/c)/c)))&#39;]  a.k.a  [sin(x/c**2) + 1/x] c =  0.5641895835477555
54               4082    [&#39;((((c+(sin((x*c))*sin((x*c))))/(sin((x*c))*sin((x*c))))-c)/((((c+(sin((x*c))*sin((x*c))))/(sin((x*c))*sin((x*c))))-c)/((c/(x*c))+sin((x*c)))))&#39;]  a.k.a  [sin(c*x) + 1/x] c =  3.1415926535902257
59               601     [&#39;(sin((x*c))+(c/(x*c)))&#39;]  a.k.a  [sin(c*x) + 1/x] c =  3.1415926537675927
64               4031    [&#39;(sin((x+(x*c)))+(c/(x*c)))&#39;]  a.k.a  [sin(c*x + x) + 1/x] c =  2.1415926536986984
66               1069    [&#39;((x/(x*x))+sin(((x+x)+(x/sin(c)))))&#39;]  a.k.a  [sin(2*x + x/sin(c)) + 1/x] c =  2.0741512360814633
73               978     [&#39;((c/(x*c))+sin((x*c)))&#39;]  a.k.a  [sin(c*x) + 1/x] c =  3.141592653745218
74               2798    [&#39;(sin((c*x))+(((c*x)/(c*x))/x))&#39;]  a.k.a  [sin(c*x) + 1/x] c =  3.141592653590368
81               2771    [&#39;(sin((x+(x*c)))+(c/(x*c)))&#39;]  a.k.a  [sin(c*x + x) + 1/x] c =  2.1415926536986984
83               2865    [&#39;(sin(((x-(x*c))-(x*c)))+(c/(x*c)))&#39;]  a.k.a  [-sin(2*c*x - x) + 1/x] c =  -1.0707963269360328
90               3688    [&#39;(sin(((c*(x*c))-x))+(c/(x*c)))&#39;]  a.k.a  [sin(c**2*x - x) + 1/x] c =  2.035090330583488
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">mean_gen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="o">&lt;</span><span class="p">(</span><span class="n">max_gen</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;ERT Expected run time = avg. number of dCGP evaluations needed: &quot;</span><span class="p">,</span> <span class="n">mean_gen</span> <span class="o">*</span> <span class="n">offsprings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ERT Expected run time = avg. number of dCGP evaluations needed:  94195.7894737
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Dario Izzo, Francesco Biscani, Alessio Mereta.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>